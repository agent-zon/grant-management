# yaml-language-server: $schema=./values.schema.json

global:
  domain: c-127c9ef.stage.kyma.ondemand.com
  imagePullSecret:
    name: docker-registry
  image:
    registry: scai-dev.common.repositories.cloud.sap
    tag: latest
srv:
  bindings:
    auth:
      serviceInstanceName: identity
      parameters:
        credential-type: X509_GENERATED
        app-identifier: grant-api
    destination:
      serviceInstanceName: destination
  image:
    repository: grant-management/api
  resources:
    limits:
      ephemeral-storage: 1G
      memory: 500M
    requests:
      ephemeral-storage: 512M
      cpu: 250m
      memory: 216M
  health:
    liveness:
      path: /health
    readiness:
      path: /health
  networkSecurity:
    allowNamespaceInternal: true
  env:
    - name: CDS_REQUIRES_AUTH_KIND
      value: "ias"
    - name: CDS_REQUIRES_DESTINATIONS_KIND
      value: "destinations"
    - name: DATABASE_URL
      value: "postgresql://grantuser:grantpass@postgresql:5432/grantdb"

approuter:
  expose:
    corsPolicy:
      allowOrigins:
        - regex: ".*-approuter-{{ .Release.Namespace }}.{{ .Values.global.domain }}"
        - exact: "https://*.{{ tpl .Values.global.domain . }}"
        - exact: "http://localhost:9000"
        - exact: "http://localhost:4338"
      allowMethods:
        - "GET"
        - "POST"
        - "PUT"
        - "DELETE"
        - "OPTIONS"
        - "PATCH"
        - "HEAD"
      allowHeaders:
        - "*"
      allowCredentials: true

  bindings:
    auth:
      serviceInstanceName: identity
      parameters:
        credential-type: X509_GENERATED
        app-identifier: approuter
  image:
    repository: grant-management/approuter
  runAsUser: 1000
  resources:
    limits:
      ephemeral-storage: 1G
      memory: 500M
    requests:
      ephemeral-storage: 1G
      cpu: 250m
      memory: 500M
  health:
    liveness:
      path: /
    readiness:
      path: /
  envFrom:
    - configMapRef:
        name: "{{ .Release.Name }}-approuter-configmap"
  env:
    # TENANT_HOST_PATTERN: "^(.*)-{{ tpl .Values.global.domain . }}"
    # TENANT_MODE: "shared"
    OTEL_EXPORTER_OTLP_ENDPOINT: http://otlp-dashboard:18889
    OTEL_EXPORTER_OTLP_PROTOCOL: http/protobuf
    OTEL_SERVICE_NAME: approuter
    OTEL_PROPAGATORS: tracecontext,baggage
portal:
  runAsUser: 1993
  bindings:
    auth:
      serviceInstanceName: identity
      parameters:
        credential-type: X509_GENERATED
        app-identifier: grant-portal
    destination:
      serviceInstanceName: destination
  image:
    repository: grant-management/portal
  resources:
    limits:
      ephemeral-storage: 1G
      memory: 500M
    requests:
      ephemeral-storage: 1G
      cpu: 500m
      memory: 500M
  health:
    liveness:
      path: /
    readiness:
      path: /
  networkSecurity:
    allowNamespaceInternal: true
  env:
    - name: DATABASE_URL
      value: "postgresql://grantuser:grantpass@postgresql:5432/grantdb"

identity:
  serviceOfferingName: identity
  servicePlanName: application
  parameters:
    display-name: agent-grants
    oauth2-configuration:
      token-policy:
        access-token-format: "jwt"
      redirect-uris:
        - https://*.{{ tpl .Values.global.domain . }}/login/callback
      post-logout-redirect-uris:
        - https://*.{{ tpl .Values.global.domain . }}/*/logout.html

backendDestinations:
  srv-api:
    service: srv
    forwardAuthToken: true
  user-portal:
    service: portal
    forwardAuthToken: true
  postgresql:
    service: postgresql
    forwardAuthToken: false

destination:
  serviceOfferingName: destination
  servicePlanName: lite
  parameters:
    version: 1.0.0

 
postgres:
  serviceOfferingName: postgresql-db
  servicePlanName: shared
