_schema-version: "1.0"
repository: ${DOCKER_REGISTRY:-scai-dev.common.repositories.cloud.sap}
tag: ${DOCKER_TAG:-latest}
before-all:
  - npx cds build --production

modules:
  - name: grant-management/api
    build-parameters:
      commands:
        - docker buildx build --platform linux/amd64 -t ${DOCKER_REGISTRY:-scai-dev.common.repositories.cloud.sap}/grant-management/api:${DOCKER_TAG:-latest} -f Dockerfile . --load

  - name: grant-management/approuter
    id: v1-approuter
    build-parameters:
      commands:
        - docker buildx build --platform linux/amd64 -t ${DOCKER_REGISTRY:-scai-dev.common.repositories.cloud.sap}/grant-management/approuter:${DOCKER_TAG:-latest} app/router --load

  - name: grant-management/grant-server
    id: v1-grant-server
    build-parameters:
      commands:
        - docker buildx build --platform linux/amd64 -t ${DOCKER_REGISTRY:-scai-dev.common.repositories.cloud.sap}/grant-management/grant-server:${DOCKER_TAG:-latest} -f app/grant-management/GrantManagementServer/Dockerfile app --load

  - name: grant-management/grant-mcp-layer
    id: v1-grant-mcp-layer
    build-parameters:
      commands:
        - docker buildx build --platform linux/amd64 -t ${DOCKER_REGISTRY:-scai-dev.common.repositories.cloud.sap}/grant-management/grant-mcp-layer:${DOCKER_TAG:-latest} -f app/grant-management/GrantMcpLayer/Dockerfile app --load

  - name: grant-management/cockpit-ui
    id: v1-cockpit-ui
    build-parameters:
      commands:
        - docker buildx build --platform linux/amd64 -t ${DOCKER_REGISTRY:-scai-dev.common.repositories.cloud.sap}/grant-management/cockpit-ui:${DOCKER_TAG:-latest} app/cockpit-ui --load
